{"source":2,"id":1,"revision":45,"name":"CD Pipeline","description":null,"createdBy":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"createdOn":"2017-11-13T20:23:00.383Z","modifiedBy":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"modifiedOn":"2017-11-16T19:38:05.217Z","isDeleted":false,"path":"\\","variables":{},"variableGroups":[],"environments":[{"id":1,"name":"QA","rank":1,"owner":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":1}]},"deployStep":{"id":2},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":3}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":8,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","workflowTasks":[{"taskId":"a0fdb0cf-30d7-4ab8-8869-fa3d0ff0a6d7","version":"1.*","name":"Push to Cloud Foundry","refName":"CloudFoundry1","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"cfEndpoint":"7dc4b412-a6f6-481d-bba9-1fcd3fcbc1f9","skipSSLValidation":"true","oneTimePassword":"false","ssoPasscode":"","org":"cdelashmutt-org","space":"qa","deploymentOptions":"manifest","cfManifest":"$(System.DefaultWorkingDirectory)/BookService/BookService/BookServicePublished/manifest.yml","name":"","instances":"","memoryLimit":"","startCommand":"","useRoute":"true","domain":"","host":"","buildPackOptions":"none","buildPackCustom":"","additionalDeployArgs":"bookservice-$(Build.BuildNumber) -n bookservice-stage","startOnDeploy":"true","createServices":"false","createServiceArgs":"","bindServices":"false","appName":"","bindServiceArgs":"","workingDirectory":"$(System.DefaultWorkingDirectory)/BookService/BookService/BookServicePublished","cfToolLocation":"$(System.DefaultWorkingDirectory)/BookService/BookService/tools/cf.exe"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Remove Old App Versions","refName":"PowerShell2","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"$(System.DefaultWorkingDirectory)/BookService/BookService","inlineScript":"& tools/cf.exe apps | foreach { ($_ -split \"\\s+\", 6)[0] } | where { $_ -ne \"bookservice-$env:Build_Buildnumber\" -and $_ -Like \"bookservice*\" }  | foreach {\n  & tools/cf.exe unmap-route $_ cf.grogscave.net --hostname bookservice-dev\n  & tools/cf.exe delete $_ -f\n}","failOnStandardError":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"autoLinkWorkItems":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]}},{"id":2,"name":"Pre Production","rank":2,"owner":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"id":4}],"approvalOptions":{"requiredApproverCount":0,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":43200,"executionOrder":1}},"deployStep":{"id":5},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":6}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":8,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","workflowTasks":[{"taskId":"a0fdb0cf-30d7-4ab8-8869-fa3d0ff0a6d7","version":"1.*","name":"Push to Cloud Foundry","refName":"CloudFoundry1","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"cfEndpoint":"7dc4b412-a6f6-481d-bba9-1fcd3fcbc1f9","skipSSLValidation":"true","oneTimePassword":"false","ssoPasscode":"","org":"cdelashmutt-org","space":"production","deploymentOptions":"manifest","cfManifest":"$(System.DefaultWorkingDirectory)/BookService/BookService/BookServicePublished/manifest.yml","name":"","instances":"","memoryLimit":"","startCommand":"","useRoute":"true","domain":"","host":"","buildPackOptions":"none","buildPackCustom":"","additionalDeployArgs":"bookservice-$(Build.BuildNumber) -n bookservice-pre","startOnDeploy":"true","createServices":"false","createServiceArgs":"","bindServices":"false","appName":"","bindServiceArgs":"","workingDirectory":"$(System.DefaultWorkingDirectory)/BookService/BookService/BookServicePublished","cfToolLocation":"$(System.DefaultWorkingDirectory)/BookService/BookService/tools/cf.exe"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"autoLinkWorkItems":false},"demands":[],"conditions":[{"name":"QA","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]}},{"id":3,"name":"Production","rank":3,"owner":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"id":"770409a2-119d-4d3c-8473-b845efe2b3a6","uniqueName":"grog@grogscave.net","imageUrl":"https://grogscave.visualstudio.com/_api/_common/identityImage?id=770409a2-119d-4d3c-8473-b845efe2b3a6&t=00000000-0000-0000-e088-c5288e69d508","displayName":"Chris DeLashmutt","url":"https://app.vssps.visualstudio.com/Afd59ddda-896b-433c-90e4-fcd030b1f252/_apis/Identities/770409a2-119d-4d3c-8473-b845efe2b3a6"},"id":10}],"approvalOptions":{"requiredApproverCount":0,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":43200,"executionOrder":1}},"deployStep":{"id":8},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":9}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":8,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent phase","workflowTasks":[{"taskId":"1b1e3b29-38c5-4ee5-8ddf-da4cba27964b","version":"0.*","name":"Login","refName":"CloudFoundryCLI1","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"cfEndpoint":"7dc4b412-a6f6-481d-bba9-1fcd3fcbc1f9","skipSSLValidation":"true","oneTimePassword":"false","ssoPasscode":"","org":"cdelashmutt-org","space":"production","cfCommand":"target","cfArguments":"","workingDirectory":"$(System.DefaultWorkingDirectory)/BookService/BookService","cfToolLocation":"$(System.DefaultWorkingDirectory)/BookService/BookService/tools/cf.exe"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Add Production Route","refName":"PowerShell1","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"$(System.DefaultWorkingDirectory)/BookService/BookService","inlineScript":"$deployedApp = \"bookservice-$env:Build_BuildNumber\"\n& tools/cf.exe map-route $deployedApp cf.grogscave.net --hostname bookservice\n& tools/cf.exe unmap-route $deployedApp cf.grogscave.net --hostname bookservice-pre","failOnStandardError":"true"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Remove Production Route from old Prod and Stop","refName":"PowerShell2","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"$(System.DefaultWorkingDirectory)/BookService/BookService","inlineScript":"& tools/cf.exe apps | foreach { ($_ -split \"\\s+\", 6)[0] } | where { $_ -ne \"bookservice-$env:Build_Buildnumber\" -and $_ -Like \"bookservice*\" }  | foreach {\n  & tools/cf.exe unmap-route $_ cf.grogscave.net --hostname bookservice\n  & tools/cf.exe stop $_ -f\n}","failOnStandardError":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"autoLinkWorkItems":false},"demands":[],"conditions":[{"name":"Pre Production","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]}}],"artifacts":[{"sourceId":"c8267721-63d5-4360-843e-e55066e33440:1","type":"Build","alias":"BookService","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://grogscave.visualstudio.com/_permalink/_build/index?collectionId=5ae20d31-716e-4710-849c-a751f76cfa32&projectId=c8267721-63d5-4360-843e-e55066e33440&definitionId=1","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"1","name":"BookService"},"project":{"id":"c8267721-63d5-4360-843e-e55066e33440","name":"BookService"}},"isPrimary":true}],"triggers":[{"artifactAlias":"BookService","triggerConditions":[{"sourceBranch":"master","tags":[],"useBuildDefinitionBranch":false}],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","url":"https://grogscave.vsrm.visualstudio.com/c8267721-63d5-4360-843e-e55066e33440/_apis/Release/definitions/1","_links":{"self":{"href":"https://grogscave.vsrm.visualstudio.com/c8267721-63d5-4360-843e-e55066e33440/_apis/Release/definitions/1"},"web":{"href":"https://grogscave.visualstudio.com/c8267721-63d5-4360-843e-e55066e33440/_release?definitionId=1"}},"tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"}}}